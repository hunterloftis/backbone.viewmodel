<!DOCTYPE html>
<html>
<head>
  <title>Backbone.ViewModel Virtuals Fiddle</title>
</head>
<body>

  <!-- Bound View -->
  <a href='#' data-switch='click: firstUser'>First user</a>
  <a href='#' data-switch='click: secondUser'>Second user</a>

  <input data-editor='val: first' placeholder='first'></div>
  <input data-editor='val: last' placeholder='last'></div>

  <p data-profile='text: fullname'></p>

  <!-- Platform dependencies -->
  <script src='../vendor/zepto-1.0rc1.js'></script>
  <script src='../vendor/underscore-1.3.3.js'></script>
  <script src='../vendor/backbone-0.9.2.js'></script>

  <!-- Backbone.ViewModel -->
  <script src='../backbone.viewmodel.js'></script>
  <script src='../backbone.virtual.js'></script>
  <script src='../backbone.binding.js'></script>
  <script src='../lib/bindings.js'></script>

  <script>

    // Users collection - the data model being manipulated
    var users = [
      new Backbone.Model({
        first: 'Hunter',
        last: 'Loftis',
        zip: ''
      }),
      new Backbone.Model({
        first: 'Amy',
        last: 'Lynn',
        zip: ''
      })
    ];

    // Switch - manages which user model is active
    var switchVM = new Backbone.ViewModel({
      model: users,
      userIndex: 0,
      firstUser: function() {
        this.set('userIndex', 0);
      },
      secondUser: function() {
        this.set('userIndex', 1);
      }
    });
    switchVM.virtual('activeUser', function get(attr) {
      var model = this.get('model');
      var index = this.get('userIndex');
      return model[index];
    });
    switchVM.bindView('data-switch');

    // Editor - edits the active user model
    var editorVM = new Backbone.ViewModel();
    editorVM.virtual('first', 'last', function model() {
      return switchVM.get('activeUser');
    });
    editorVM.bindView('data-editor');

    // Profile - displays transformed data from the active user model
    var profileVM = new Backbone.ViewModel();
    profileVM.virtual('fullname', function(attr) {
      return switchVM.get('activeUser').get('first') + ' ' + switchVM.get('activeUser').get('last');
    });
    profileVM.bindView('data-profile');

  </script>

</body>
</html>